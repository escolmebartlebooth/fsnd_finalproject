function locationModel(o){var e=this;e.name=o.name,e.ground=o.ground,e.location=o.location,e.champions=o.champions,e.filtered=ko.observable(!0),e.news=[],e.wiki=[],e.infoContent='<div class="infowin"><label>'+e.name+":<label><p># of championships: "+e.champions+"</p></div>",e.getNews=function(o){0===e.news.length?$.ajax({type:"GET",url:"https://api.nytimes.com/svc/search/v2/articlesearch.json",data:{q:e.ground,sort:"newest","response-format":"jsonp","api-key":"648ff5452e49454b855476afbc2d1b9b",callback:"svc_search_v2_articlesearch"},success:function(n){n.response.docs&&n.response.docs.length>0?n.response.docs.forEach(function(o){e.news.push({description:o.headline.main.substring(0,30)+"...",url:o.web_url})}):e.news.push({description:"no news",url:""}),o.news(e.news)},error:function(n,i,t){e.news.push({description:"error looking for news",url:""}),o.news(e.news),console.log("jqXHR:"),console.log(n),console.log("textStatus:"),console.log(i),console.log("errorThrown:"),console.log(t)}}):o.news(e.news)},e.getWiki=function(o){var n="https://en.wikipedia.org/w/api.php?";n+=$.param({action:"query",list:"search",srsearch:e.ground,format:"json",callback:"wikiCallback"}),0===e.wiki.length?$.ajax({url:n,dataType:"jsonp",success:function(n){n.query.search&&n.query.search.length>0?n.query.search.forEach(function(o){e.wiki.push({description:o.title,url:"https://en.wikipedia.org/wiki/"+o.title})}):e.wiki.push({description:"no wiki",url:""}),o.wiki(e.wiki)},error:function(n,i,t){e.news.push({description:"error looking for wiki",url:""}),o.news(e.wiki),console.log("jqXHR:"),console.log(n),console.log("textStatus:"),console.log(i),console.log("errorThrown:"),console.log(t)}}):o.wiki(e.wiki)},e.marker=new google.maps.Marker({position:{lat:e.location.lat,lng:e.location.lng},icon:icons.locationNormal,map:map,title:e.name+" "+e.ground,location:e})}function locationsViewModel(){var o=this,e=new google.maps.LatLngBounds;o.init=function(){var n,i=[];locationdata.forEach(function(t){(n=new locationModel(t)).marker.addListener("click",o.markerClick),i.push(n),e.extend(n.marker.position)}),o.locations(i),map.fitBounds(e)},google.maps.event.addDomListener(window,"resize",function(){google.maps.event.trigger(map,"resize"),map.fitBounds(e)}),o.news=ko.observableArray([{description:"no news",url:""}]),o.wiki=ko.observableArray([{description:"no wiki",url:""}]),o.isOpen=ko.observable(!1),o.isInfoOpen=ko.observable(!1),o.infoState=ko.observable(!0),o.toggle=function(){o.isOpen(!o.isOpen())},o.enableInfo=function(){o.infoState()?(o.infoState(!1),o.hideInfo()):o.infoState(!0)},o.showInfo=function(){o.infoState()&&o.isInfoOpen(!0)},o.hideInfo=function(){o.isInfoOpen(!1)},o.mapStyle=ko.observable(),o.toggleMap=function(){"roadmap"===map.getMapTypeId()?map.setMapTypeId("styled_map"):map.setMapTypeId("roadmap")},o.locations=ko.observableArray([]),o.selectedLocation=ko.observable(null),o.locationAnimate=function(){o.selectedLocation().location.getNews(o),o.selectedLocation().location.getWiki(o),o.showInfo(),o.selectedLocation().setAnimation(google.maps.Animation.BOUNCE),o.selectedLocation().icon=icons.locationSelected,mapInfoWindow.setContent(o.selectedLocation().location.infoContent),mapInfoWindow.open(map,o.selectedLocation())},o.locationUnAnimate=function(){o.hideInfo(),o.selectedLocation().setAnimation(null),o.selectedLocation().icon=icons.locationNormal,mapInfoWindow.close()},o.makeSelection=function(e){o.selectedLocation()===e?(o.locationUnAnimate(),o.selectedLocation(null)):null!==o.selectedLocation()?(o.locationUnAnimate(),o.selectedLocation(e),o.locationAnimate()):(o.selectedLocation(e),o.locationAnimate())},o.markerClick=function(){o.makeSelection(this)},o.clickLocation=function(){o.makeSelection(this.marker)},o.filterValue=ko.observable(""),o.filterOn=ko.observable(!1),o.applyFilter=function(){reg=new RegExp(o.filterValue(),"i"),o.filterOn(!0),o.locations().forEach(function(e,n){reg.test(e.name)?(o.locations()[n].marker.setVisible(!0),o.locations()[n].filtered(!0)):(o.locations()[n].marker.setVisible(!1),o.locations()[n].filtered(!1))})},o.removeFilter=function(){o.filterOn(!1),o.locations().forEach(function(e,n){o.locations()[n].marker.setVisible(!0),o.locations()[n].filtered(!0)})},o.doFilter=function(){o.filterValue().length>2?o.applyFilter():o.filterOn()&&o.removeFilter()},o.init()}function mapError(){alert("map error"),mapState(!0)}function initMap(){mapState(!1);var o=new google.maps.StyledMapType(mapstyle,{name:"locations"});(map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:initialCenter,disableDefaultUI:!0})).mapTypes.set("styled_map",o),map.setMapTypeId("styled_map"),mapInfoWindow=new google.maps.InfoWindow({content:""}),ko.applyBindings(new locationsViewModel)}var map,mapState=ko.observable(!1),mapInfoWindow,initialCenter={lat:53.817265,lng:-1.5848782},iconroot="http://maps.google.com/mapfiles/ms/icons/",icons={locationSelected:iconroot+"ylw-pushpin.png",locationNormal:iconroot+"red-pushpin.png"};