function locationmodel(e){var o=this;o.name=e.name,o.ground=e.ground,o.location=e.location,o.champions=e.champions,o.filtered=ko.observable(!0),o.news=[],o.wiki=[],o.getNews=function(){if(0!==o.news.length)return o.news;$.ajax({type:"GET",url:"https://api.nytimes.com/svc/search/v2/articlesearch.json",data:{q:o.ground,sort:"newest","response-format":"jsonp","api-key":"648ff5452e49454b855476afbc2d1b9b",callback:"svc_search_v2_articlesearch"},success:function(e){return e.response.docs&&e.response.docs.length>0?e.response.docs.forEach(function(e){o.news.push({description:e.headline.main.substring(0,30)+"...",url:e.web_url})}):o.news.push({description:"no news",url:""}),o.news}})},o.getWiki=function(){var e="https://en.wikipedia.org/w/api.php?";if(e+=$.param({action:"query",list:"search",srsearch:o.ground,format:"json",callback:"wikiCallback"}),0!==o.wiki.length)return o.wiki;$.ajax({url:e,dataType:"jsonp",success:function(e){return console.log(e),e.query.search&&e.query.search.length>0?e.query.search.forEach(function(e){o.wiki.push({description:e.title,url:"https://en.wikipedia.org/wiki/"+e.title})}):o.wiki.push({description:"no wiki",url:""}),o.wiki}})},o.marker=new google.maps.Marker({position:{lat:o.location.lat,lng:o.location.lng},icon:icons.locationnormal,map:map,title:o.name+" "+o.ground,location:o}),o.infowindow=new google.maps.InfoWindow({content:'<div class="infowin"><label>'+o.name+":<label><p># of championships: "+o.champions+"</p></div>"})}function locationsVM(){var e=this;e.init=function(){var o,n=[],i=new google.maps.LatLngBounds;locationdata.forEach(function(t){(o=new locationmodel(t)).marker.addListener("click",e.markerClick),n.push(o),i.extend(o.marker.position)}),e.locations(n),map.fitBounds(i)},e.news=ko.observableArray([{description:"no news",url:""}]),e.wiki=ko.observableArray([{description:"no wiki",url:""}]),e.isOpen=ko.observable(!1),e.isInfoOpen=ko.observable(!1),e.infoState=ko.observable(!1),e.toggle=function(){e.isOpen(!e.isOpen())},e.enableInfo=function(){e.infoState()?(e.infoState(!1),e.hideInfo()):e.infoState(!0)},e.showInfo=function(){e.infoState()&&e.isInfoOpen(!0)},e.hideInfo=function(){e.isInfoOpen(!1)},e.mapStyle=ko.observable(),e.toggleMap=function(){"roadmap"===map.getMapTypeId()?map.setMapTypeId("styled_map"):map.setMapTypeId("roadmap")},e.locations=ko.observableArray([]),e.selectedlocation=ko.observable(null),e.locationAnimate=function(){e.news(e.selectedlocation().location.getNews()),e.wiki(e.selectedlocation().location.getWiki()),e.showInfo(),e.selectedlocation().setAnimation(google.maps.Animation.BOUNCE),e.selectedlocation().icon=icons.locationselected,e.selectedlocation().location.infowindow.open(map,e.selectedlocation())},e.locationUnAnimate=function(){e.hideInfo(),e.selectedlocation().setAnimation(null),e.selectedlocation().icon=icons.locationnormal,e.selectedlocation().location.infowindow.close()},e.makeselection=function(o){e.selectedlocation()===o?(e.locationUnAnimate(),e.selectedlocation(null)):null!==e.selectedlocation()?(e.locationUnAnimate(),e.selectedlocation(o),e.locationAnimate()):(e.selectedlocation(o),e.locationAnimate())},e.markerClick=function(){e.makeselection(this)},e.clicklocation=function(){e.makeselection(this.marker)},e.filtervalue=ko.observable(""),e.filterOn=ko.observable(!1),e.applyfilter=function(){reg=new RegExp(e.filtervalue(),"i"),e.filterOn(!0),e.locations().forEach(function(o,n){reg.test(o.name)?(e.locations()[n].marker.setMap(map),e.locations()[n].filtered(!0)):(e.locations()[n].marker.setMap(null),e.locations()[n].filtered(!1))})},e.removefilter=function(){e.filterOn(!1),e.locations().forEach(function(o,n){e.locations()[n].marker.setMap(map),e.locations()[n].filtered(!0)})},e.dofilter=function(){e.filtervalue().length>2?e.applyfilter():e.filterOn()&&e.removefilter()},e.init()}function mapError(){console.log("called")}function initMap(){var e=new google.maps.StyledMapType(mapstyle,{name:"locations"});(map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:initialCenter,disableDefaultUI:!0})).mapTypes.set("styled_map",e),map.setMapTypeId("styled_map"),ko.applyBindings(new locationsVM)}var map,initialCenter={lat:53.817265,lng:-1.5848782},iconroot="http://maps.google.com/mapfiles/ms/icons/",icons={locationselected:iconroot+"ylw-pushpin.png",locationnormal:iconroot+"red-pushpin.png"};